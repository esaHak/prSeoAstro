---
/**
 * Custom 404 Error Page
 * SEO-friendly error page with navigation and recommendations
 */

import BaseLayout from '../layouts/BaseLayout.astro';
import { DB } from '../utils/db';
import { resolveOgImage } from '../utils/images';
import { defaultLocale, getLocalizedField } from '../utils/i18n';

const base = import.meta.env.BASE_URL;
const siteBase = Astro.site?.toString() || 'https://prseoastro.pages.dev';
const locale = defaultLocale;

// Resolve OG image
const ogImage = resolveOgImage({}, undefined, siteBase);

// Get popular categories for recommendations
const categories = DB.getAllCategories();
const popularCategories = categories.slice(0, 3).map(category => ({
  title: getLocalizedField<string>(category, 'title', locale) || category.id,
  description: getLocalizedField<string>(category, 'description', locale) || '',
  url: `${base}${locale}/${category.slug}/`
}));
---

<BaseLayout
  title="Page Not Found - 404"
  description="The page you're looking for doesn't exist. Explore our guides to find what you need."
  ogImage={ogImage}
  noindex={true}
>
  <div style="text-align: center; padding: 3rem 1rem;">
    <h1 style="font-size: 4rem; margin-bottom: 0.5rem; color: #333;">404</h1>
    <h2 style="font-size: 1.5rem; margin-bottom: 1.5rem; color: #666; font-weight: normal;">
      Page Not Found
    </h2>
    <p style="font-size: 1.1rem; margin-bottom: 2rem; color: #555; max-width: 500px; margin-left: auto; margin-right: auto;">
      Sorry, the page you're looking for doesn't exist or has been moved.
      Let's get you back on track.
    </p>

    <div style="margin-bottom: 3rem;">
      <a
        href={`${base}${locale}/`}
        style="display: inline-block; padding: 1rem 2rem; background: #333; color: #fff; text-decoration: none; border-radius: 6px; font-weight: 500; transition: background 0.2s;"
      >
        ‚Üê Go to Homepage
      </a>
    </div>
  </div>

  <section style="margin: 2rem 0; padding: 2rem; background: #f9f9f9; border-radius: 8px;">
    <h3 style="margin-top: 0; text-align: center;">Popular Guides</h3>
    <p style="text-align: center; margin-bottom: 1.5rem; color: #666;">
      Here are some of our most popular resources:
    </p>

    <div style="display: grid; gap: 1rem; max-width: 800px; margin: 0 auto;">
      {popularCategories.map((category) => (
        <a
          href={category.url}
          style="display: block; padding: 1rem 1.5rem; background: #fff; border: 1px solid #ddd; border-radius: 6px; text-decoration: none; color: #333; transition: border-color 0.2s, box-shadow 0.2s;"
        >
          <strong style="color: #0066cc;">{category.title}</strong>
          <p style="margin: 0.5rem 0 0 0; font-size: 0.9rem; color: #666;">
            {category.description.slice(0, 100)}...
          </p>
        </a>
      ))}
    </div>
  </section>

  <section style="margin: 2rem 0; text-align: center;">
    <h3>Looking for something specific?</h3>
    <p style="color: #666; margin-bottom: 1rem;">
      Try browsing our main categories or check if the URL is correct.
    </p>
    <div style="display: flex; justify-content: center; gap: 1rem; flex-wrap: wrap;">
      <a href={`${base}en/`} style="color: #0066cc;">English Homepage</a>
      <span style="color: #ccc;">|</span>
      <a href={`${base}fi/`} style="color: #0066cc;">Suomeksi</a>
    </div>
  </section>
</BaseLayout>

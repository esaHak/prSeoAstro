---
/**
 * Hero Image Component
 * Renders optimized hero image with WebP conversion, responsive srcset,
 * and optional credit link (nofollow for third-party)
 *
 * Features:
 * - Automatic WebP format with fallback
 * - Responsive srcset for different viewport sizes
 * - Priority loading for above-the-fold images
 * - Prevents CLS with explicit dimensions
 * - Accessible credit attribution
 */
import type { ImageWithUrl, OptimizedImage } from '../utils/images/types';
import { createOptimizedImage } from '../utils/images/optimization';
import OptimizedPicture from './OptimizedPicture.astro';

interface Props {
  image: ImageWithUrl | OptimizedImage;
  /** For loading="eager" vs "lazy" - hero images default to priority */
  priority?: boolean;
}

const { image, priority = true } = Astro.props;

// Convert to optimized image if not already
const optimizedImage: OptimizedImage = 'webpSrcset' in image
  ? image
  : createOptimizedImage(image, {
      webp: true,
      srcset: true,
      sizes: '100vw', // Hero images are full-width
    });
---

<div class="hero-image-container" style="margin: 2rem 0;">
  <OptimizedPicture
    image={optimizedImage}
    priority={priority}
    style="width: 100%; height: auto; border-radius: 8px; display: block;"
    sizes="100vw"
  />

  {image.creditName && image.creditUrl && (
    <p class="image-credit" style="margin: 0.5rem 0; font-size: 0.875rem; color: #666;">
      Image:
      <a
        href={image.creditUrl}
        rel="nofollow noopener noreferrer"
        target="_blank"
        style="color: #0066cc;"
      >
        {image.creditName}
      </a>
      {image.license && ` (${image.license})`}
    </p>
  )}
</div>

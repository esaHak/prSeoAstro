---
/**
 * CategoryCard Component
 * Displays a category/subcategory as a card with image, title, and description
 * Used in child categories and related categories grids
 */
import type { ImageWithUrl, OptimizedImage } from '../utils/images/types';
import { createOptimizedImage } from '../utils/images/optimization';
import OptimizedPicture from './OptimizedPicture.astro';

interface Props {
  title: string;
  description: string;
  url: string;
  /** Optional featured image for the card */
  image?: ImageWithUrl | OptimizedImage | null;
  /** Show "Learn more" link at bottom of card */
  showLink?: boolean;
}

const { title, description, url, image, showLink = true } = Astro.props;

// Optimize image if provided and not already optimized
// Hero images are 1200x400 (3:1 aspect ratio)
let optimizedImage: OptimizedImage | null = null;
if (image) {
  optimizedImage = 'webpSrcset' in image
    ? image
    : createOptimizedImage(image, {
        webp: true,
        srcset: true,
        sizes: '(max-width: 640px) 100vw, (max-width: 1024px) 50vw, 400px',
      });
}

// Truncate description if too long (keep under ~120 chars)
const truncatedDesc = description.length > 120
  ? description.slice(0, 117).trim() + '...'
  : description;
---

<article class="category-card">
  <a href={url} class="category-card__image-container">
    {optimizedImage ? (
      <OptimizedPicture
        image={optimizedImage}
        priority={false}
        class="category-card__image"
        sizes="(max-width: 640px) 100vw, (max-width: 1024px) 50vw, 400px"
      />
    ) : (
      <div class="category-card__placeholder">
        <svg
          width="48"
          height="48"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="1.5"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
          <circle cx="8.5" cy="8.5" r="1.5"></circle>
          <polyline points="21 15 16 10 5 21"></polyline>
        </svg>
      </div>
    )}
  </a>

  <div class="category-card__content">
    <h3 class="category-card__title">
      <a href={url}>{title}</a>
    </h3>

    {truncatedDesc && (
      <p class="category-card__description">{truncatedDesc}</p>
    )}

    {showLink && (
      <a href={url} class="category-card__link">
        Learn more
        <span class="category-card__link-arrow" aria-hidden="true">â†’</span>
      </a>
    )}
  </div>
</article>

<style>
  .category-card__placeholder {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, #F5F0E8 0%, #E8E4DC 100%);
    color: #999999;
  }
</style>
